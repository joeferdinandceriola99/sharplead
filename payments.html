<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sharplead — Payments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/style.css">
  <script src="assets/data.js"></script>
  <script src="assets/common.js"></script>
</head>
<body>
<script>renderHeader('payments')</script>
<div class="container-fluid py-3">
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>Payments</span>
    <div class="d-flex gap-2">
      <select id="pmFilter" class="form-select form-select-sm"><option value="">All</option><option>GCash</option><option>Maya</option><option>Card</option><option>Bank</option></select>
      <input id="search" class="form-control form-control-sm" placeholder="Search txn…">
      <button id="export" class="btn btn-sm btn-outline-primary">Export CSV</button>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-dark table-hover align-middle mb-0" id="table">
      <thead><tr><th>Txn</th><th>User</th><th>Amount</th><th>Method</th><th>Status</th><th>When</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const S = window.DemoSeed;
function render(){
  const m=document.getElementById('pmFilter').value||'';
  const s=(document.getElementById('search').value||'').toLowerCase();
  const rows = S.payments.filter(p=>(!m||p.method===m) && (p.id+s+p.player).toLowerCase().includes(s))
  .map(p=>{ const tr=document.createElement('tr'); const badge=p.status==='Succeeded'?'success':p.status==='Failed'?'danger':'secondary'; tr.innerHTML=`<td>${p.id}</td><td>${p.player}</td><td>${money(p.amount, Demo.currency)}</td><td>${p.method}</td><td><span class="badge text-bg-${badge}">${p.status}</span></td><td>${p.when}</td>`; return tr; });
  const tb=document.querySelector('#table tbody'); tb.innerHTML=''; rows.forEach(r=>tb.appendChild(r));
}
document.getElementById('pmFilter').addEventListener('change',render);
document.getElementById('search').addEventListener('input',render);
document.getElementById('export').addEventListener('click',()=>{
  const rows = [['Txn','User','Amount('+Demo.currency+')','Method','Status','When'], ...S.payments.map(p=>[p.id,p.player, (new Intl.NumberFormat('en-US')).format(p.amount*Demo.fx[Demo.currency]), p.method,p.status,p.when])];
  const csv = rows.map(r=>r.join(',')).join('\\n'); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='payments.csv'; a.click();
});
render(); window.onCurrencyChange = render;
</script>
</body></html>